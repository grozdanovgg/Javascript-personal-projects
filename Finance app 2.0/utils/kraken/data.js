const KrakenClient = require('kraken-api');
const indexes = require('../DataTools/indexes');
const config = require('../../config/config');

const key = '/Wssk/nmVmB8MGRXgYgajq6z26WvCSO7fiNQG5fKl7Bq78bwl6+MfgAu'; // API Key
const secret = 'TNMOaDROEAODqKNnm4eWG1IOFAhaN37XF55/XbEL+uFPr572zQBBCUxbyJHBjF7lqClz28LJqFzrGK7c8WRy3w=='; // API Private Key


const mockKrakenData = {
    result: {
        BTCETH: [
            // [1, 1, 2, 3, 86.16],
            // [1, 1, 2, 3, 89.09],
            // [1, 1, 2, 3, 88.78],
            // [1, 1, 2, 3, 90.32],
            // [1, 1, 2, 3, 89.07],
            // [1, 1, 2, 3, 91.15],
            // [1, 1, 2, 3, 89.44],
            // [1, 1, 2, 3, 89.18],
            // [1, 1, 2, 3, 86.93],
            // [1, 1, 2, 3, 87.68],
            // [1, 1, 2, 3, 86.96],
            // [1, 1, 2, 3, 89.43],
            // [1, 1, 2, 3, 89.32],
            // [1, 1, 2, 3, 88.72],
            // [1, 1, 2, 3, 87.45],
            // [1, 1, 2, 3, 87.26],
            // [1, 1, 2, 3, 89.50],
            // [1, 1, 2, 3, 87.90],
            // [1, 1, 2, 3, 89.13],
            // [1, 1, 2, 3, 90.70],
            // [1, 1, 2, 3, 92.90],
            // [1, 1, 2, 3, 92.98],
            // [1, 1, 2, 3, 91.80],
            // [1, 1, 2, 3, 92.66],
            // [1, 1, 2, 3, 92.68],
            // [1, 1, 2, 3, 92.30],
            // [1, 1, 2, 3, 92.77],
            // [1, 1, 2, 3, 92.54],
            // [1, 1, 2, 3, 92.95],
            // [1, 1, 2, 3, 93.20],
            // [1, 1, 2, 3, 91.07],
            // [1, 1, 2, 3, 89.83],
            // [1, 1, 2, 3, 89.74],
            // [1, 1, 2, 3, 90.40],
            // [1, 1, 2, 3, 90.74],
            // [1, 1, 2, 3, 88.02],
            // [1, 1, 2, 3, 88.09],
            // [1, 1, 2, 3, 88.84],
            // [1, 1, 2, 3, 90.78],
            // [1, 1, 2, 3, 90.54],
            // [1, 1, 2, 3, 91.39],
            // [1, 1, 2, 3, 90.65],
            // [1, 22.184, 23.8324, 22.0847, 22.2734],
            // [1, 22.184, 23.8324, 22.0847, 22.194],
            // [1, 22.184, 23.8324, 22.0847, 22.0847],
            // [1, 22.184, 23.8324, 22.0847, 22.1741],
            // [1, 22.184, 23.8324, 22.0847, 22.184],
            // [1, 22.184, 23.8324, 22.0847, 22.1344],
            // [1, 22.184, 23.8324, 22.0847, 22.2337],
            // [1, 22.184, 23.8324, 22.0847, 22.4323],
            // [1, 22.184, 23.8324, 22.0847, 22.2436],
            // [1, 22.184, 23.8324, 22.0847, 22.2933],
            // [1, 22.184, 23.8324, 22.0847, 22.1542],
            // [1, 22.184, 23.8324, 22.0847, 22.3926],
            // [1, 22.184, 23.8324, 22.0847, 22.3816],
            // [1, 22.184, 23.8324, 22.0847, 22.6109],
            // [1, 22.184, 23.8324, 22.0847, 23.3558],
            // [1, 22.184, 23.8324, 22.0847, 24.0519],
            // [1, 22.184, 23.8324, 22.0847, 23.753],
            // [1, 22.184, 23.8324, 22.0847, 23.8324],
            // [1, 22.184, 23.8324, 22.0847, 23.9516],
            // [1, 22.184, 23.8324, 22.0847, 23.6338],
            // [1, 22.184, 23.8324, 22.0847, 23.8225],
            // [1, 22.184, 23.8324, 22.0847, 23.8722],
            // [1, 22.184, 23.8324, 22.0847, 23.6537],
            // [1, 22.184, 23.8324, 22.0847, 23.187],
            // [1, 22.184, 23.8324, 22.0847, 23.0976],
            // [1, 22.184, 23.8324, 22.0847, 23.326],
            // [1, 22.184, 23.8324, 22.0847, 22.6805],
            // [1, 22.184, 23.8324, 22.0847, 23.0976],
            // [1, 22.184, 23.8324, 22.0847, 22.4025],
            // [1, 22.184, 23.8324, 22.0847, 22.1725],
            [1, 2, 48.70, 47.79, 48.16],
            [1, 2, 48.72, 48.14, 48.61],
            [1, 2, 48.90, 48.39, 48.75],
            [1, 2, 48.87, 48.37, 48.63],
            [1, 2, 48.82, 48.24, 48.74],
            [1, 2, 49.05, 48.635, 49.03],
            [1, 2, 49.20, 48.94, 49.07],
            [1, 2, 49.35, 48.86, 49.32],
            [1, 2, 49.92, 49.50, 49.91],
            [1, 2, 50.19, 49.87, 50.13],
            [1, 2, 50.12, 49.20, 49.53],
            [1, 2, 49.66, 48.90, 49.5],
            [1, 2, 49.88, 49.43, 49.75],
            [1, 2, 50.19, 49.725, 50.03],
            [1, 2, 50.36, 49.26, 50.31],
            [1, 2, 50.57, 50.09, 50.52],
            [1, 2, 50.65, 50.30, 50.41],
            [1, 2, 50.43, 49.21, 49.34],
            [1, 2, 49.63, 48.98, 49.37],
            [1, 2, 50.33, 49.61, 50.23],
            [1, 2, 50.29, 49.20, 49.2375],
            [1, 2, 50.17, 49.43, 49.93],
            [1, 2, 49.32, 48.08, 48.43],
            [1, 2, 48.50, 47.64, 48.18],
            [1, 2, 48.3201, 41.55, 46.57],
            [1, 2, 46.80, 44.2833, 45.41],
            [1, 2, 47.80, 47.31, 47.77],
            [1, 2, 48.39, 47.20, 47.72],
            [1, 2, 48.66, 47.90, 48.62],
            [1, 2, 48.79, 47.7301, 47.85],
        ]
    }
}



function processKrekenData(rawData, pair, interval) {
    const pairKrakenName = Object.getOwnPropertyNames(rawData.result)[0];
    const firstData = rawData.result[pairKrakenName];
    const openings = [];
    const highests = [];
    const lowests = [];
    const closings = [];

    firstData.map((moment) => {
        openings.push(+(+moment[1]).toFixed(4));
        highests.push(+(+moment[2]).toFixed(4));
        lowests.push(+(+moment[3]).toFixed(4));
        closings.push(+(+moment[4]).toFixed(4));
    });
    openings.reverse();
    highests.reverse();
    lowests.reverse();
    closings.reverse();

    const result = {
        exchange: 'kraken',
        pair,
        interval,
        openings,
        highests,
        lowests,
        closings
    };
    const nPeriod = config.indexes.nPeriod;

    result.SMA = indexes.SMA(result, nPeriod);
    result.BB = indexes.BB(result, nPeriod);
    result.SD = indexes.SD(result, nPeriod);
    result.EMA = indexes.EMA(result, nPeriod);
    result.KC = indexes.KC(result, nPeriod);

    return result;
}

const get = {
    OHLC: async(pair, interval) => {
        try {
            // const kraken = new KrakenClient(key, secret);
            // // @ts-ignore
            // const rawData = await kraken.api('OHLC', { pair, interval });
            const result = processKrekenData(mockKrakenData, pair, interval);
            return result;
        } catch (err) {
            console.log('in the error of kraken util, OHLC method');
            return console.log(err);
        }
    }
}
module.exports = get;
